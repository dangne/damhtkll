#include <stdio.h>
#include <math.h>
#include "matrix.h"
#include "mlp.h"
#include "layers.h"
#include "xil_printf.h"

int MLP(Matrix input){
	xil_printf("Inside MLP\n");
    double w0[784][64]; 
	weight(&w0, 0);


	xil_printf("Inside MLP 1\n");
    double b0[1][64]; 
	bias(&b0, 0);


	xil_printf("Inside MLP 2\n");
    double w1[64][10]; 
	weight(&w1, 1);


	xil_printf("Inside MLP 3\n");
    double b1[1][10]; 
	bias(&b1, 1);


	xil_printf("Inside MLP 4\n");
    double hidden[1][64]; 
    MUL(hidden, input,  w0);
    ADD(hidden, hidden, b0);
    RELU(hidden);

	xil_printf("Inside MLP 5\n");
    double output[1][10]; 
    MUL(output, hidden, w1);
    ADD(output, output, b1);
    RELU(output);
    SOFTMAX(output);

	xil_printf("Inside MLP 6\n");
    int result = 0;
    for (int i = 0 ; i < LEN(output[0]) ; i++)
    	if (output[0][i] > output[0][result])
    		result = i;

	xil_printf("Inside MLP 7\n");
    return result;
}
